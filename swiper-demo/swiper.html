<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.4.6/css/swiper.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.4.6/js/swiper.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

  <style>
    html, body {
      position: relative;
      height: 100%;
    }
    body {
      background: #eee;
      font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
      font-size: 14px;
      color:#000;
      margin: 0;
      padding: 0;
    }
    .swiper-container {
      width: 100%;
      height: 100%;
      color: white;
    }
    .swiper-slide {
      background-position: center;
      background-size: cover;
    }
    img, video {
      width: 100%;
      height: 100%;
    }
    video {
      object-fit: cover;
    }
  </style>
</head>
<body>
  <!-- Swiper -->
  <div class="swiper-container">
    <div class="swiper-wrapper" id="swiperBox">
    </div>
  </div>
  <!-- Initialize Swiper -->
  <script>
    window.onload = function() {
      var md, md1;
      var utils = {
        state: {
          picTime: 2,// 图片时间
          textTime: 2,// 文字时间
          data: [],
        },
        countDown: function(count, callback){
          var times = setInterval(function(){
            if (count > 0) {
              count--;
            }else {
              clearInterval(times)
              if (callback) callback();
            }

          }, 1000);
        },
        picEle: function(data = {}, index){
          return  `<div class="swiper-slide" style="background: grey">
                  <img src="${data.ur}" alt="">
                </div>`;
        },
        videoEle: function(data = {}, index){
          return  `<div class="swiper-slide" style="background: grey">
                    <video id="media${index}" class="media${index}" width="100%" height="100%" muted>
                      <source src="${data.ur}">
                    </video>
                  </div>`;
        },
        textEle: function(data = {}, index){
          return  `<div class="swiper-slide" style="background: grey">
                  ${data.content}
                </div>`;
        },
        getChildEle: function(data = []){
          var childEle = '';
          for (var i = 0; i < data.length; i++) {
            if(data[i].type == 0) {
              childEle += utils.picEle(data[i]);
            }else if(data[i].type == 1) {

              childEle += utils.videoEle(data[i], i);
            }else if(data[i].type == 2) {

              childEle += utils.textEle(data[i]);
            }
          }
          return childEle;
        },
        getListData: function(){
          $.ajax({
            url:"http://286a8305.ngrok.io/test/list1",
            type:"get",
            async:false,//同步
            data:{},//传出的数据
            dataType:"json",//返回的数据类型，常用：html/text/json
            success:function(data){
              utils.state.data = data.rows;
              var parentEle = document.getElementById("swiperBox");
              parentEle.innerHTML = utils.getChildEle(utils.state.data);
            }
          })
        },
        mockListData: function(){
          utils.state.data = [
              {
                "searchValue": null,
                "createBy": null,
                "createTime": null,
                "updateBy": null,
                "updateTime": null,
                "remark": "",
                "params": {},
                "id": 1,
                "fileName": "图片1",
                "type": 0,
                "ur": "http://img3.duitang.com/uploads/item/201608/13/20160813093241_UiKmA.jpeg",
                "content": "",
                "order": 1
              },
              {
                "searchValue": null,
                "createBy": null,
                "createTime": null,
                "updateBy": null,
                "updateTime": null,
                "remark": "",
                "params": {},
                "id": 1,
                "fileName": "图片1",
                "type": 0,
                "ur": "https://b-ssl.duitang.com/uploads/item/201505/23/20150523152813_r28Vk.jpeg",
                "content": "",
                "order": 1
              },
              {
                "searchValue": null,
                "createBy": null,
                "createTime": null,
                "updateBy": null,
                "updateTime": null,
                "remark": "",
                "params": {},
                "id": 3,
                "fileName": "视频1",
                "type": 1,
                "ur": "http://www.w3school.com.cn/example/html5/mov_bbb.ogg",
                "content": "",
                "order": 3
              },
              {
                "searchValue": null,
                "createBy": null,
                "createTime": null,
                "updateBy": null,
                "updateTime": null,
                "remark": "",
                "params": {},
                "id": 3,
                "fileName": "视频1",
                "type": 1,
                "ur": "http://www.w3school.com.cn/i/movie.ogg",
                "content": "",
                "order": 3
              },
              {
                "searchValue": null,
                "createBy": null,
                "createTime": null,
                "updateBy": null,
                "updateTime": null,
                "remark": "",
                "params": {},
                "id": 1,
                "fileName": "图片1",
                "type": 2,
                "ur": "http://b-ssl.duitang.com/uploads/item/201410/03/20141003171521_uPuJN.thumb.700_0.jpeg",
                "content": '<div class="antd-pro\components\-page-header\index-pageHeader"><div class=""><div class="antd-pro\components\-page-header\index-breadcrumb ant-breadcrumb"><span><span class="ant-breadcrumb-link"><a href="/finance/"><span>首页</span></a></span><span class="ant-breadcrumb-separator">/</span></span><span><span class="ant-breadcrumb-link"><span to="/distributor">经销商</span></span><span class="ant-breadcrumb-separator">/</span></span><span><span class="ant-breadcrumb-link"><span to="/distributor/account">经销商账户</span></span><span class="ant-breadcrumb-separator">/</span></span></div><div class="antd-pro\components\-page-header\index-detail"><div class="antd-pro\components\-page-header\index-main"><div class="antd-pro\components\-page-header\index-row"></div><div class="antd-pro\components\-page-header\index-row"></div></div></div></div></div>',
                "order": 1
              },
          ]
          var parentEle = document.getElementById("swiperBox");
          parentEle.innerHTML = utils.getChildEle(utils.state.data);
        }
      };

      utils.mockListData()

      var mySwiper = new Swiper('.swiper-container', {
        spaceBetween: 30,
        effect: 'fade',
        direction: 'horizontal', // 垂直切换选项
        loop: true, // 循环模式选项
        width: window.innerWidth,
        height: window.innerHeight,
        on: {
          init: function(){
            //Swiper初始化了
            document.body.click();
            document.body.click();
          },
          slideChangeTransitionEnd: function(){
            document.body.click();
            document.body.click();
            this.myActiveIndex = this.activeIndex > utils.state.data.length? 1 : this.activeIndex;
            if(utils.state.data[this.myActiveIndex-1].type == 0) {
              utils.countDown(utils.state.picTime, function() {mySwiper.slideNext()});

            }else if(utils.state.data[this.myActiveIndex-1].type == 1) {
              if(this.activeIndex >= utils.state.data.length){
                md1 = document.querySelectorAll(`.media${this.myActiveIndex-1}`)[1];
                md1.currentTime=0;
                md1.removeAttribute('muted')
                md1.play();
                this.mVideoEnd1 = function(){
                  md1.currentTime=0;
                  if(utils.state.data.length <= 1){
                    md1.play();

                  }else{
                    // mySwiper.slideNext();
                    mySwiper.slideTo(1, 1000);//切换到第一个slide
                    md1.removeEventListener('ended', this.mVideoEnd1)
                  }

                }
                md1.addEventListener("ended", this.mVideoEnd1)

              }else {
                md = document.querySelectorAll(`.media${this.myActiveIndex-1}`)[0];
                md.currentTime=0;
                md.removeAttribute('muted')
                md.play();
                this.mVideoEnd = function(){
                  md.currentTime=0;
                  mySwiper.slideNext();
                  md.removeEventListener('ended', this.mVideoEnd)
                }
                md.addEventListener("ended", this.mVideoEnd)

              }

            }else if(utils.state.data[this.myActiveIndex-1].type == 2) {
              utils.countDown(utils.state.textTime, function() {mySwiper.slideNext()})

            }else {
              utils.countDown(utils.state.picTime, function() {mySwiper.slideNext()})

            }
          },
        },
      });
     
    }

  </script>
</body>
</html>